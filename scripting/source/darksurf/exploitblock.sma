#include <amxmodx>
#include <sub_stocks>
#include <engine>
#include <sub_time>
#include <cstrike>
#include <darksurf.inc>
#include <sub_roundtime>
#include <sub_damage>
#include <sub_respawn>
#include <fun>

new numducks[33]
new induck[33]
new Float:lastduck[33]

public plugin_init() {
   	register_plugin("DARKSURF - EXPLOIT BLOCK","T9k","Team9000")

	return PLUGIN_CONTINUE
}

public client_connect(id) {
	numducks[id] = 0
	induck[id] = 0
	lastduck[id] = 0.0
}

public dam_respawn(id) {
	numducks[id] = 0
	induck[id] = 0
	lastduck[id] = 0.0
}

public client_PreThink(id) {
	if(!is_user_alive(id))
		return PLUGIN_CONTINUE

	new Float:gametime = get_gametime();

	if(lastduck[id] < gametime-0.15) {
		numducks[id] = 0;
	}

	new duckpushed = get_user_button(id) & IN_DUCK;
	if(!induck[id] && duckpushed) {
		numducks[id]++;
		if(numducks[id] > 5) {
			if(get_upperhealth()) {
				set_user_health(id, 1+256000);
			} else {
				set_user_health(id, 1);
			}
			dam_dealdamage(id, id, 100000, "crouching", 0, 1, 0, 0, 0);
			alertmessage(id,3,"Crouch cheat detected!!!");
			numducks[id] = 0;
		}
	}
	induck[id] = duckpushed;

	return PLUGIN_CONTINUE
}
